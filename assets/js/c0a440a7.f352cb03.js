"use strict";(globalThis.webpackChunkpioreactor=globalThis.webpackChunkpioreactor||[]).push([[741],{28453(e,t,o){o.d(t,{R:()=>i,x:()=>a});var n=o(96540);const r={},s=n.createContext(r);function i(e){const t=n.useContext(s);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),n.createElement(s.Provider,{value:t},e.children)}},73953(e,t,o){o.r(t),o.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"important-concepts","title":"Important concepts","description":"Operating system","source":"@site/developer-guide/02-important-concepts.md","sourceDirName":".","slug":"/important-concepts","permalink":"/developer-guide/important-concepts","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Important concepts","slug":"/important-concepts","hide_table_of_contents":true},"sidebar":"tutorialSidebar","previous":{"title":"Introduction for developers","permalink":"/developer-guide/introduction"},"next":{"title":"Introduction to background jobs","permalink":"/developer-guide/intro-background-jobs"}}');var r=o(74848),s=o(28453);const i={title:"Important concepts",slug:"/important-concepts",hide_table_of_contents:!0},a=void 0,c={},l=[{value:"Operating system",id:"operating-system",level:3},{value:"An initial mental model of Pioreactor software",id:"an-initial-mental-model-of-pioreactor-software",level:3},{value:"Cluster topology",id:"cluster-topology",level:3},{value:"Networking and communication",id:"networking-and-communication",level:3},{value:"MQTT",id:"mqtt",level:3}];function d(e){const t={a:"a",code:"code",em:"em",h3:"h3",li:"li",ol:"ol",p:"p",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h3,{id:"operating-system",children:"Operating system"}),"\n",(0,r.jsxs)(t.p,{children:["The Pioreactor runs ontop of a Raspberry Pi. We provide the operating system that runs on the Raspberry Pi as downloadable images. The operating system the latest version of ",(0,r.jsx)(t.em,{children:"Raspberry Pi OS"})," (a fork of ",(0,r.jsx)(t.em,{children:"Debian Trixie"})," at the time of writing) with our custom modifications."]}),"\n",(0,r.jsx)(t.h3,{id:"an-initial-mental-model-of-pioreactor-software",children:"An initial mental model of Pioreactor software"}),"\n",(0,r.jsx)(t.p,{children:"The Pioreactor software works as follows:"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"Different jobs, like stirring, OD reading, dosing, etc. are controlled by separate Python objects. Some jobs will passively listen for events from other jobs, and change their behavior in response, for example, dosing automations listen to OD readings, and may respond by dosing or not dosing."}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:['The main "control plane" for the Pioreactor software is the command line interface, ',(0,r.jsx)(t.code,{children:"pio"}),". For example, when the user starts a activity from the UI, the web server will run ",(0,r.jsx)(t.code,{children:"pio run <some activity> --arguments"}),", which launches a Python process that will instantiate the object the controls the activity."]}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsx)(t.p,{children:"Because each activity is a separate Python process, we can modify an activity before running it by changing files on the filesystem."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"cluster-topology",children:"Cluster topology"}),"\n",(0,r.jsxs)(t.p,{children:['One of the Raspberry Pi\'s is assigned as the "leader", and this hosts most of the services: web server, MQTT broker, database, etc. It also sends commands to any "workers". The leader can also be a worker. Together, the leader and all the workers are called a "cluster". A cluster can be a small as a single leader+worker. See more information about clusters ',(0,r.jsx)(t.a,{href:"/user-guide/create-cluster",children:"here"}),"."]}),"\n",(0,r.jsx)(t.h3,{id:"networking-and-communication",children:"Networking and communication"}),"\n",(0,r.jsx)(t.p,{children:"The Raspberry Pis / Pioreactors communicate through the local network (in more advanced cases, this network is hosted on the leader). Users control the Pioreactor cluster while being on the same network, and accessing the web UI or the command line of the Pioreactors."}),"\n",(0,r.jsx)(t.p,{children:"Leaders talk to Pioreactors via http requests between their respective web servers (using lighttpd + Flask, on port 80 by default). Workers send experiment data back to the leader via MQTT (see below). We expect users to control the leader only (using the web interface or CLI), and let the leader control the workers (there are exceptions)."}),"\n",(0,r.jsx)(t.h3,{id:"mqtt",children:"MQTT"}),"\n",(0,r.jsxs)(t.p,{children:["MQTT is message-broker system that the Pioreactor uses to communicate between Pioreactors and between processes. Think of it as an in-memory event log, and any software in the cluster can interact with it. The leader Pioreactor hosts the message-broker (using the software ",(0,r.jsx)(t.a,{href:"https://mosquitto.org/",children:"Mosquitto"}),"), and worker Pioreactors (which are called MQTT ",(0,r.jsx)(t.em,{children:"clients"}),") will read and write to it. On the leader's command line, you can view the event log with ",(0,r.jsx)(t.code,{children:"pio mqtt"}),"."]}),"\n",(0,r.jsx)(t.p,{children:"The Pioreactor UI also connects to MQTT, and uses it to push and pull live data from the activities in each Pioreactor (states of activities, settings, graphs, etc)."})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);