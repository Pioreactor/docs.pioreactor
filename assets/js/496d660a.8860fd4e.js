"use strict";(self.webpackChunkpioreactor=self.webpackChunkpioreactor||[]).push([[6682],{40783:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>s,contentTitle:()=>r,default:()=>c,frontMatter:()=>a,metadata:()=>d,toc:()=>l});var i=o(85893),t=o(11151);const a={title:"Avoiding when optical density is run",slug:"/avoiding-od",hide_table_of_contents:!0},r=void 0,d={id:"Background jobs/avoiding-od",title:"Avoiding when optical density is run",description:"It's common to want a feature to turn off, or more generally change behaviour, when a sensitive optical density reading is taken. For example, if running an air bubbler, you may want to turn it off before an OD reading is taken, and then turn if back on after.",source:"@site/developer-guide/03-Background jobs/03-avoiding-od.md",sourceDirName:"03-Background jobs",slug:"/avoiding-od",permalink:"/developer-guide/avoiding-od",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Avoiding when optical density is run",slug:"/avoiding-od",hide_table_of_contents:!0},sidebar:"tutorialSidebar",previous:{title:"Writing a custom background job",permalink:"/developer-guide/writing-background-jobs"},next:{title:"Automations architecture",permalink:"/developer-guide/intro-automations"}},s={},l=[];function g(e){const n={code:"code",em:"em",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",...(0,t.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"It's common to want a feature to turn off, or more generally change behaviour, when a sensitive optical density reading is taken. For example, if running an air bubbler, you may want to turn it off before an OD reading is taken, and then turn if back on after."}),"\n",(0,i.jsxs)(n.p,{children:["This behaviour is so common, we've added a helper class to take care of it for you. In ",(0,i.jsx)(n.code,{children:"pioreactor.background_jobs.base"})," is the class ",(0,i.jsx)(n.code,{children:"BackgroundJobWithDodgingContrib"}),' that implements most of the "dodging" behaviour for you. you\'ll only need to do three things:']}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Inherit from ",(0,i.jsx)(n.code,{children:"BackgroundJobWithDodgingContrib"}),", instead of ",(0,i.jsx)(n.code,{children:"BackgroundJobContrib"})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from pioreactor.background_jobs.base import BackgroundJobWithDodgingContrib\n\nclass JustPause(BackgroundJobWithDodgingContrib):\n    ...\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsxs)(n.li,{children:["Fill in what to do before, and after, an OD reading takes place by implementing method ",(0,i.jsx)(n.code,{children:"action_to_do_before_od_reading"})," and ",(0,i.jsx)(n.code,{children:"action_to_do_after_od_reading"}),", respectively."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'class JustPause(BackgroundJobWithDodgingContrib):\n\n    def __init__(self, ...):\n        super().__init__(..., enable_dodging_od=False, plugin_name="just-pause") # set to True if you want the dodging behaviour right away.\n\n\n    def action_to_do_before_od_reading(self):\n        # example\n        self.logger.debug("Pausing")\n        self.stop_pumping()\n\n    def action_to_do_after_od_reading(self):\n        # example\n        self.logger.debug("Unpausing")\n        self.start_pumping()\n\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsxs)(n.li,{children:["You should also consider what the job should do if OD reading isn't turned on. That is, what should the default behaviour be without OD reading. Also, what should occur when the OD reading is turned on ",(0,i.jsx)(n.em,{children:"late"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:['You can handle the "dodging" case and "continuous" with the ',(0,i.jsx)(n.code,{children:"initialize_*"})," methods:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'class JustPause(BackgroundJobWithDodgingContrib):\n\n    def __init__(self, ...):\n        super().__init__(..., enable_dodging_od=False, plugin_name="just-pause") # set to True if you want the dodging behaviour right away.\n\n    ...\n\n    def initialize_dodging_operation(self):\n        self.logger.debug("OD reading is ON and I\'m enabled for dodging, so set up what I need...")\n\n    def initialize_continuous_operation(self):\n        self.logger.debug("OD reading is off, or being ignored, so set up what I need for that...")\n\n    def action_to_do_before_od_reading(self):\n        # example\n        self.logger.debug("Pausing")\n        self.stop_pumping()\n\n    def action_to_do_after_od_reading(self):\n        # example\n        self.logger.debug("Unpausing")\n        self.start_pumping()\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsx)(n.li,{children:'We also want some "buffer" time before and after an OD reading. For example, if using a bubbler, we want the bubbles to dissipate completely before taking an OD reading. We should stop bubbling early then. To set these times, add the following to your config.ini:'}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"[<job_name>.config]\npre_delay_duration=<float>\npost_delay_duration=<float>\nenable_dodging_od=1\n"})}),"\n",(0,i.jsx)(n.p,{children:"The diagram of timing, actions, and OD reading, looks like the following:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:o(27093).Z+"",width:"766",height:"444"})}),"\n",(0,i.jsx)(n.p,{children:"And you're done!"})]})}function c(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(g,{...e})}):g(e)}},27093:(e,n,o)=>{o.d(n,{Z:()=>i});const i=o.p+"assets/images/background_job_dodging_timing-a0b9f9066fcfd7d7d990ba25ed36a25f.png"},11151:(e,n,o)=>{o.d(n,{Z:()=>d,a:()=>r});var i=o(67294);const t={},a=i.createContext(t);function r(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);