"use strict";(self.webpackChunkpioreactor=self.webpackChunkpioreactor||[]).push([[8961],{92544:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>i,metadata:()=>a,toc:()=>d});var o=t(85893),r=t(11151);const i={title:"Creating and editing experiment profiles",slug:"/create-edit-experiment-profiles"},s=void 0,a={id:"Extending your Pioreactor/Experiment Profiles/create-edit-experiment-profiles",title:"Creating and editing experiment profiles",description:"Using the UI",source:"@site/user-guide/03-Extending your Pioreactor/04-Experiment Profiles/02-create-edit-experiment-profiles.md",sourceDirName:"03-Extending your Pioreactor/04-Experiment Profiles",slug:"/create-edit-experiment-profiles",permalink:"/user-guide/create-edit-experiment-profiles",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Creating and editing experiment profiles",slug:"/create-edit-experiment-profiles"},sidebar:"tutorialSidebar",previous:{title:"Intro to experiment profiles",permalink:"/user-guide/experiment-profiles"},next:{title:"Experiment profiles schema",permalink:"/user-guide/experiment-profiles-schema"}},l={},d=[{value:"Using the UI",id:"using-the-ui",level:3},{value:"On the command line",id:"on-the-command-line",level:3},{value:"Tips to writing profiles",id:"tips-to-writing-profiles",level:2},{value:"How the <code>if</code> directive works",id:"how-the-if-directive-works",level:3},{value:"Expressions in options",id:"expressions-in-options",level:3},{value:"Start/stop controllers instead of automations",id:"startstop-controllers-instead-of-automations",level:3},{value:"Update automations instead of controllers",id:"update-automations-instead-of-controllers",level:3},{value:"YAML syntax check, and indentation problems",id:"yaml-syntax-check-and-indentation-problems",level:3},{value:"<code>Expected `object`, got `array` - at ` ... .options`</code>",id:"expected-object-got-array---at---options",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h3,{id:"using-the-ui",children:"Using the UI"}),"\n",(0,o.jsxs)(n.p,{children:["Experiment profiles can be managed in the UI at ",(0,o.jsx)(n.a,{href:"http://pioreactor.local/experiment-profiles",children:"http://pioreactor.local/experiment-profiles"}),". See video below for a demonstration."]}),"\n",(0,o.jsx)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/yxxj0ncTxws?si=42eGY8yIt5D84qUA",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:!0}),"\n",(0,o.jsx)(n.h3,{id:"on-the-command-line",children:"On the command line"}),"\n",(0,o.jsxs)(n.p,{children:["All profiles are stored on the leader's disk under ",(0,o.jsx)(n.code,{children:"~/.pioreactor/experiment_profiles/"}),". You can create and edit profiles in this directory, as well."]}),"\n",(0,o.jsx)(n.h2,{id:"tips-to-writing-profiles",children:"Tips to writing profiles"}),"\n",(0,o.jsxs)(n.h3,{id:"how-the-if-directive-works",children:["How the ",(0,o.jsx)(n.code,{children:"if"})," directive works"]}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["Currently the ",(0,o.jsx)(n.code,{children:"if"})," directive is only available in the ",(0,o.jsx)(n.code,{children:"pioreactors"})," block, and ",(0,o.jsx)(n.em,{children:"not"})," the ",(0,o.jsx)(n.code,{children:"common"})," block."]})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"if"})," directive can be included in any action to conditionally execute it or not. The ",(0,o.jsx)(n.code,{children:"if"})," statement is evaluated ",(0,o.jsx)(n.em,{children:"when the action is to be executed"})," (i.e., when ",(0,o.jsx)(n.code,{children:"elapsed_hours"})," has passed)."]}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"if"})," directive is a general boolean expression, and to common operators can be used:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"and"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"or"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"not"})}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"True"})," and ",(0,o.jsx)(n.code,{children:"False"})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"("})," and ",(0,o.jsx)(n.code,{children:")"})]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Also included are numbers (floats), and strings (examples later). The comparison operators are:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"=="})}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:">="})," and ",(0,o.jsx)(n.code,{children:"<="})]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:">"})," and ",(0,o.jsx)(n.code,{children:"<"})]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["The operators addition ",(0,o.jsx)(n.code,{children:"+"}),", subtraction ",(0,o.jsx)(n.code,{children:"-"}),", multiplication ",(0,o.jsx)(n.code,{children:"*"}),", and division ",(0,o.jsx)(n.code,{children:"/"})," are allowed on floats, as well."]}),"\n",(0,o.jsx)(n.p,{children:"Also available is dynamic data, provided from jobs. For example, the following:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"pio1::stirring::target_rpm\n"})}),"\n",(0,o.jsxs)(n.p,{children:["will fetch the ",(0,o.jsx)(n.code,{children:"target_rpm"})," from ",(0,o.jsx)(n.code,{children:"pio1"}),"'s ",(0,o.jsx)(n.code,{children:"stirring"})," job ",(0,o.jsx)(n.em,{children:"at the time the action is to be executed"}),". To use this in an example:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"    stirring:\n     ...\n     - type: update\n       hours_elapsed: 6.0\n       if: pio1::stirring::target_rpm >= 500\n       options:\n         target_rpm: 400\n\n"})}),"\n",(0,o.jsxs)(n.p,{children:["will check, after 6 hours, if the ",(0,o.jsx)(n.code,{children:"target_rpm"})," is above 500, and if true, will update the target RPM to 400."]}),"\n",(0,o.jsxs)(n.p,{children:["You can also compare against strings. For example, to stop a job if the temperature automation running is equal to ",(0,o.jsx)(n.code,{children:"thermostat"}),", use:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"    temperature_control:\n     ...\n     - type: stop\n       hours_elapsed: 6.0\n       if: pio1::temperature_control::automation_name == thermostat\n\n\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Where do these dynamic values come from? Each job has ",(0,o.jsx)(n.code,{children:"published_settings"})," that can be referenced (refer to the job's source code to all ",(0,o.jsx)(n.code,{children:"published_settings"})," for a job, or they are published in MQTT)."]}),"\n",(0,o.jsxs)(n.p,{children:["Some published settings have are actually nested json blobs, but we need either numbers or strings to compare in our boolean expression. You can index these json blobs in the boolean expression using ",(0,o.jsx)(n.code,{children:"."}),", for example:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"    temperature_automation:\n     ...\n     - type: update\n       hours_elapsed: 6.0\n       if: pio1::temperature_control::temperature.temperature <= 30\n       options:\n         target_temperature: 32\n"})}),"\n",(0,o.jsxs)(n.p,{children:["We use ",(0,o.jsx)(n.code,{children:"temperature.temperature"})," because the ",(0,o.jsx)(n.code,{children:"temperature"}),' published setting is a json blob that looks like the following, and we wish to reference the "temperature" field in the blob:']}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:'    {\n        "temperature": <float>,\n        "timestamp": <ISO 8601 timestamp>\n    }\n'})}),"\n",(0,o.jsx)(n.h3,{id:"expressions-in-options",children:"Expressions in options"}),"\n",(0,o.jsxs)(n.p,{children:["Similar to an ",(0,o.jsx)(n.code,{children:"if"})," directive using dynamic data, options can also have dynamic data (see notes above for syntax, too). However, to distinguish between a string and an expression, an expression ",(0,o.jsx)(n.strong,{children:"must"})," be wrapped in ",(0,o.jsx)(n.code,{children:"${{ ... }}"}),". For example, consider the following ",(0,o.jsx)(n.code,{children:"update"})," action:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"pioreactors:\n  worker1:\n    jobs:\n      stirring:\n        actions:\n          - type: start\n            hours_elapsed: 0\n            options:\n              target_rpm: 500\n          - type: update\n            hours_elapsed: 12\n            options:\n              target_rpm: ${{ worker1:stirring:target_rpm + 50 }}\n\n"})}),"\n",(0,o.jsxs)(n.p,{children:["This will update the value of ",(0,o.jsx)(n.code,{children:"target_rpm"})," to whatever its current value is (after 1 hour), and add 50 to it."]}),"\n",(0,o.jsxs)(n.p,{children:["You can use the any pioreactor and any job in an expression - you aren't limited to the ",(0,o.jsx)(n.code,{children:"job"})," your editing. For example, the ",(0,o.jsx)(n.code,{children:"update"})," below will dynamically set the ",(0,o.jsx)(n.code,{children:"target_rpm"})," to a function of optical density."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"pioreactors:\n  worker1:\n    jobs:\n      stirring:\n        actions:\n          - type: start\n            hours_elapsed: 0\n            options:\n              target_rpm: 500\n          - type: update\n            hours_elapsed: 12\n            options:\n              target_rpm: ${{ worker1:stirring:target_rpm + worker1:od_reading:od1.od * 10 }}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"startstop-controllers-instead-of-automations",children:"Start/stop controllers instead of automations"}),"\n",(0,o.jsx)(n.p,{children:"A common task is to start the thermostat, and you may want to do something like:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"# wrong, this won't work  \u274c\ncommon:\n  jobs:\n    thermostat:\n      actions:\n        - type: start\n          hours_elapsed: 0.0\n          options:\n            target_temperature: 30\n\n"})}),"\n",(0,o.jsxs)(n.p,{children:["However, to start (and stop) automations (which the ",(0,o.jsx)(n.code,{children:"thermostat"})," is), you actually need to use the controllers:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"# correct \u2705\ncommon:\n  jobs:\n    temperature_control:\n      actions:\n        - type: start\n          hours_elapsed: 0.0\n          options:\n            automation_name: thermostat\n            target_temperature: 30\n\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Likewise, to ",(0,o.jsx)(n.em,{children:"stop"})," a automation, you need to stop the controller:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"# correct \u2705\ncommon:\n  jobs:\n    temperature_control:\n      actions:\n        - type: start\n          hours_elapsed: 0.0\n          options:\n            automation_name: thermostat\n            target_temperature: 30\n        - type: stop\n          hours_elapsed: 12.0\n\n"})}),"\n",(0,o.jsxs)(n.p,{children:["How do you update ",(0,o.jsx)(n.code,{children:"target_temperature"}),", see below."]}),"\n",(0,o.jsx)(n.h3,{id:"update-automations-instead-of-controllers",children:"Update automations instead of controllers"}),"\n",(0,o.jsxs)(n.p,{children:["A setting like ",(0,o.jsx)(n.code,{children:"target_temperature"})," or ",(0,o.jsx)(n.code,{children:"volume"})," is attached to the automation, not a controller, so you need to update the automation:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"# correct  \u2705\ncommon:\n  jobs:\n    temperature_control:\n      actions:\n        - type: start\n          hours_elapsed: 0.0\n          options:\n            automation_name: thermostat\n            target_temperature: 30\n        - type: stop\n          hours_elapsed: 12.0\n    temperature_automation: # this is thermostat\n        - type: update\n          hours_elapsed: 1.0\n          options:\n            target_temperature: 32\n        - type: update\n          hours_elapsed: 2.0\n          options:\n            target_temperature: 34\n\n"})}),"\n",(0,o.jsx)(n.h3,{id:"yaml-syntax-check-and-indentation-problems",children:"YAML syntax check, and indentation problems"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Check your YAML syntax with a tool like: ",(0,o.jsx)(n.a,{href:"https://www.yamllint.com/",children:"https://www.yamllint.com/"})]}),"\n",(0,o.jsx)(n.li,{children:"Note that indentation matters! For example, these mean different things, and only the second one is correct:"}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"# wrong \u274c\ncommon:\n  jobs:\n    temperature_control:\n      actions:\n        - type: start\n          hours_elapsed: 0.0\n          options:\n          automation_name: thermostat # this should be indented to align with options\n          target_temperature: 30      # this should be indented to align with options\n\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"# correct \u2705\ncommon:\n  jobs:\n    temperature_control:\n      actions:\n        - type: start\n          hours_elapsed: 0.0\n          options:\n            automation_name: thermostat # lined up!\n            target_temperature: 30\n\n"})}),"\n",(0,o.jsx)(n.h3,{id:"expected-object-got-array---at---options",children:(0,o.jsx)(n.code,{children:"Expected `object`, got `array` - at ` ... .options`"})}),"\n",(0,o.jsxs)(n.p,{children:["This is likely because you are using ",(0,o.jsx)(n.code,{children:"-"})," where you shouldn't:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"# wrong \u274c\ncommon:\n  jobs:\n    temperature_control:\n      actions:\n        - type: start\n          hours_elapsed: 0.0\n          options:\n            - automation_name: thermostat # don't put - here\n            - target_temperature: 30 # don't put - here\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"# correct \u2705\ncommon:\n  jobs:\n    temperature_control:\n      actions:\n        - type: start\n          hours_elapsed: 0.0\n          options:\n            automation_name: thermostat # don't put - here\n            target_temperature: 30 # don't put - here\n"})})]})}function p(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},11151:(e,n,t)=>{t.d(n,{Z:()=>a,a:()=>s});var o=t(67294);const r={},i=o.createContext(r);function s(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);